
> Information Gathering on Linux systems

Types
- remote (from attacker machine across the network to the target)
- local (on the target machine)

## Remote Enumeration

> Doing enumeration over the network to detect/identify remote machines and services. Can be done with tools like `nmap` or other tools/scripts

Here is an overview over the covered services for enumeration on Linux systems:

| Service | Port(s) | Description |
| - | - | - |
| `NFS` | 2049 (tcp/udp) | [Network File System](https://wiki.ubuntuusers.de/NFS/) |
| `rpcbind` | 111 (tcp/udp), 32771 (tcp/udp) | Portmapper, binding `rpc` services to ports |
| `Samba` | 137,138,139 (all: tcp/udp), 445 (tcp) | `SMB`/`CIFS` for Linux ([samba](https://www.samba.org/samba/what_is_samba.html)) |
| `smtp` | 25 (tcp) | [Simple Mail Transfer Protocol](https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol) |
| `finger` | 79 (tcp) | [Finger](https://en.wikipedia.org/wiki/Finger_(protocol)) |


### NFS

`NFS` further relies on `mountd` and shares files over the network via "exports" (found on the server at `/etc/exports`).

#### 1. Check if shares are configured

```bash
ls /usr/share/nmap/scripts | grep nfs # check for scripts
nmap --script nfs-ls <targetIP> # nmap
nmap --script nfs-ls,nfs-showmount,nfs-statfs <targetIP> # nmap with all scripts

# also
showmount -e <targetIP> # displays exports/shares
```

#### 2. Try Mounting them locally

```bash
mkdir -p /mnt/home/bla # name of the share for ease of recognition
mount -t nfs <nfsServerIP>:/home/bla /mnt/home/bla -o nolock 

# verify via
mount
```

#### 3. If successfull chech files and permissions

```bash
ls -la /mnt/home/bla
```

### rpcBind

> aka portmapper -> maps RPC services to their corresponding tcp/udp port
> Can also be seen as static port map for RPC-based services, if enumerated with nmap

#### 1. Display ports bound via rpcbind

Using `nmap` scripts

```bash
ls /usr/share/nmap/scripts | grep rpc # check for rpc scripts
nmap --script rpc-grind,rpcinfo <targetIP> -p 111
```

### Samba

> Located on the same ports as `NetBIOS`

```bash
# verify if its running on the target
nmap -sT -sU -sV <targetIP> -p135,137,138,139,445 --open
```

#### 1. Check for available/accessible shares

```bash
# nmap 
nmap --script smb-enum-shares <targetIP> -p 445

# alternatively, use smbclient
smbclient -L <targetIP>

# check permissions
smbmap -H <targetIP>
```

#### 2. Mount the shares / access them

```bash
mkdir /mnt/www
mount -t cifs \\\\<targetIP>\\www /mnt/www

# or access via smbclient
smbclient \\\\<targetIP>\\sharename -N  # anon login with no password
```

#### 3. Enumeration of username

```bash
# anon login and resolution of usernames in a loop
for u in $(cat users.txt); do rpcclient -U "" <targetIP> -N --command="lookupnames $u"; done | grep "User: 1"

# or manually via
rpcclient <targetIP>
> lookupnames name1 name2 name3

# or enum4linux
enum4linux <targetIP> | grep "Local User"
```

### SMTP

> OS independent, as they can be run on either Linux or Windows (sendmail, postfix, exim, msexchange)

#### 0. Check if port is open and `smtp` running

```bash
# via nmap
ls /usr/share/nmap/scripts | grep smtp
nmap --script smtp-commands <targetIP> -p 25  # checkcs for allowed VERBs

# or if 25 is open
nc <targetIP> # connect to mailserver interactively
> help
```

#### 1. Enumeration of E-Mail users

```bash
nc <targetIP>
> HELO <domain.name> # bla.com (identifying your domain)
> help  # check for usable VERBs

# enumerate via RCPT TO:
RCPT TO: johndoe@target.domain
# valid user: 250 2.1.5
# invalid : 550 5.1.1 

# enumerate via EXPN
EXPN johndoe # same statuscodes as above 

# enumerate via VRFY
VRFY johndoe # same statuscodes as above
```

- [pentestmonkey](https://pentestmonkey.net/tools/user-enumeration/smtp-user-enum) automated via perl script

```bash
smtp-user-enum -M VRFY -U users.txt -t <targetIP>
```

-> Requires a good list, or the knowledge of how email adresses are generated (surname.name@example.com or name@example.com)

### Finger

> Enumeration for user or serviceaccounts with the loginshell, email or other information - if added in the system

#### 1. Check via `nmap`

```bash
nmap --script finger <targetIP> -p79
```

#### 2. Check manually for accounts 

```bash
finger sshd@<targetIP> # checks for sshd acc on target system
```

#### 3. Automated approach

```bash
for name in $(cat /usr/share/wordlists/metasploit/user.txt); do finger $name@<targetIP>; done > valid_users.txt
```

## Local enumeration

> Requires local access to the target machine, some kind of shell or session in order to run the commands.

Types of information
- network information
- system specific information

#### Network information

> Contains a combination of commands - the goal is to get an overview of the part of the network the target is connected to and probable other segmentes in its vincinity.

```bash
# get interfaces with their IPs and connected subnets
ip a

# Routing of packets into other networks
route

# check for 'hidden' segments in the networks via num of hops
traceroute -n <ipAddress>

# Check for domain names or specific hosts
cat /etc/resolv.conf

# See close neighbors in the network
arp

# Check open connections to other machines
netstat -auntp
ss -twurp  # if netstat not available
```

- if `netstat` and `ss` are not working or missing [source](https://staaldraad.github.io/2017/12/20/netstat-without-netstat/)
	- check `/proc/ent/tcp`
	- check `/proc/net/udp`

#### System information

> Again the goal is to get as much information about the local system: services, their versions, operating system, users etc.

```bash
# get os and version
uname -a

# check last logings for all present users on this system
lastlog

# check current logins to the system
w

# check last logins to this machine
last

# check sudoers file
sudo -l

# get all users and their groups
for user in $(cat /etc/passwd | cut -f1 -d":"); do id $user; done
```

Also check for read permissions of interesting files (and directories):

```bash
cat /etc/sudoers
cat /root/.bash_history

ls /root -la  # check if we can list something

# check for history files we can read from other users
find /home/* -name '*.*history' -print 2> /dev/null 
```

Interesting files with write permissions
```bash
# check for chronjobs that can be altered
find /etc/cron* -type f -perm -o+w -exec ls -l {} \;
```

Furthermore check for `root` users on this system

```bash
# check for id 0 accounts
cat /etc/passwd |cut -f1,3,4 -d":" |grep "0:0" |cut -f1 -d":" |awk '{print $1}'
```

Also check `SUID`, `GUID` files

```bash
find / -perm -4000 -type f 2>/dev/null # uid files
find / -uid 0 –perm -4000 –type f 2>/dev/null # owned by root
find / -perm -2000 -type -f 2>/dev/null # guid files
find -perm -2 -type f 2>/dev/null # world writeable

lsof -n # check currently open files
```

Information about processes and their binaries

```bash
ps aux | awk '{print $11}' |xargs -r ls -la 2>/dev/null |awk '!x[$0]++'
```


Also: `linpeas.sh` is your friend!